<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>index</title>
    <script src="DataTable.js"></script>
    <link rel="stylesheet" href="tableTheme1.css">
</head>
<style>
    #container {
        width: 600px;
    }
</style>
<body>
<div id="container"></div>
</body>

<script>
    var currentUser = "lisi";
    var data = [
        {
            equipment: "CT03",
            doctor: ""
        },
        {
            equipment: "MR01",
            doctor: "lisi"
        },
        {
            equipment: "CT02",
            doctor: "lisi"
        },
        {
            equipment: "MR_未定义",
            doctor: "wangwu"
        },
        {
            equipment: "MR03",
            doctor: ""
        },
        {
            equipment: "CT01",
            doctor: "zhangsan"
        },
        {
            equipment: "DR01",
            doctor: "yaya"
        }
    ];
    var columns = [
        {
            name: "equipment",
            default: "未知设备",
            otherCss: {}
        },
        {
            name: "doctor",
            default: "未被占用",
            otherCss: {}
        },
        {
            default: '-',
            otherCss: {
                textAlign: 'center'
            }
        }
    ];
    var tableContainer = document.querySelector('#container');
    var statusColor = {
        free: "#58C4A0",
        occupiedByCurrUser: "#ccc"
    };
    var dataTable = new DataTable(data, columns);
    dataTable.thead = ["设备编号", "占用医生", "操作"];
//    dataTable.filterBy = {
//        equipment: /未定义/,
//        doctor:/^yaya$|^zhangsan$/
//    };
    dataTable.filterBy = function (i) {
        var a = /未定义/.test(i.equipment) == false;
        var b = ["yaya","zhangsan"].indexOf(i.doctor) == -1;
        return a && b;
    };
    dataTable.sortBy = "equipment";

    dataTable.onrowdraw = function (row, data) {
        var btn = row.lastElementChild;
        if (data.doctor == currentUser) {
            btn.innerHTML = '<input type="button" value="解除占用">';
            row.style.background = statusColor.occupiedByCurrUser;
            btn.onclick = function (e) {
                //发数据

                //获取数据并更新
//                dataTable.data = newData;
//                dataTable.refreshData();
            }
        }
        if (data.doctor == "") {
            btn.innerHTML = '<input type="button" value="切换到该设备">';
            row.style.background = statusColor.free;
            btn.onclick = function (e) {
                //发数据

                //获取数据并更新
//                dataTable.data = newData;
//                dataTable.refreshData();
            }
        }
        btn.style.cursor = "pointer";
    };
    dataTable.draw(tableContainer);
    data.push({
        equipment: "MR02",
        doctor: "wangwu"
    });
    //定时刷新数据
    !function drawData() {
        //获取最新数据
        dataTable.refreshData(data);
        setTimeout(function () {
            drawData();
        }, 3000);
    }();
</script>
</html>
